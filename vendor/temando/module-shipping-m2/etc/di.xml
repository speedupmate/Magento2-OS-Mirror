<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <!-- global interface preferences -->
    <preference for="Temando\Shipping\Api\Quote\ShippingMethodManagementInterface"
                type="Temando\Shipping\Model\Quote\ShippingMethodManagement" />
    <preference for="Temando\Shipping\Api\Rma\RmaShipmentManagementInterface"
                type="Temando\Shipping\Model\Rma\RmaShipmentManagement" />

    <preference for="Temando\Shipping\Model\CarrierInterface"
                type="Temando\Shipping\Model\Carrier" />
    <preference for="Temando\Shipping\Model\LocationInterface"
                type="Temando\Shipping\Model\Location" />
    <preference for="Temando\Shipping\Model\PackagingInterface"
                type="Temando\Shipping\Model\Packaging" />
    <preference for="Temando\Shipping\Model\ShipmentInterface"
                type="Temando\Shipping\Model\Shipment" />
    <preference for="Temando\Shipping\Model\Shipment\FulfillmentInterface"
                type="Temando\Shipping\Model\Shipment\Fulfillment" />
    <preference for="Temando\Shipping\Model\Shipment\ExportDeclarationInterface"
                type="Temando\Shipping\Model\Shipment\ExportDeclaration" />
    <preference for="Temando\Shipping\Model\Shipment\CapabilityInterface"
                type="Temando\Shipping\Model\Shipment\Capability" />
    <preference for="Temando\Shipping\Model\Shipment\ShipmentDestinationInterface"
                type="Temando\Shipping\Model\Shipment\ShipmentDestination" />
    <preference for="Temando\Shipping\Model\Shipment\ShipmentOriginInterface"
                type="Temando\Shipping\Model\Shipment\ShipmentOrigin" />
    <preference for="Temando\Shipping\Model\Shipment\TrackEventInterface"
                type="Temando\Shipping\Model\Shipment\TrackEvent" />
    <preference for="Temando\Shipping\Model\Shipment\PackageInterface"
                type="Temando\Shipping\Model\Shipment\Package" />
    <preference for="Temando\Shipping\Model\Shipment\PackageItemInterface"
                type="Temando\Shipping\Model\Shipment\PackageItem" />
    <preference for="Temando\Shipping\Model\DispatchInterface"
                type="Temando\Shipping\Model\Dispatch" />
    <preference for="Temando\Shipping\Model\Dispatch\ShipmentInterface"
                type="Temando\Shipping\Model\Dispatch\Shipment" />
    <preference for="Temando\Shipping\Model\DispatchProviderInterface"
                type="Temando\Shipping\Model\DispatchProvider" />
    <preference for="Temando\Shipping\Model\DocumentationInterface"
                type="Temando\Shipping\Model\Documentation" />
    <preference for="Temando\Shipping\Model\OrderInterface"
                type="Temando\Shipping\Model\Order" />
    <preference for="Temando\Shipping\Model\Order\CheckoutFieldContainerInterface"
                type="Temando\Shipping\Model\Order\CheckoutFieldContainer" />
    <preference for="Temando\Shipping\Model\Order\OrderBillingInterface"
                type="Temando\Shipping\Model\Order\OrderBilling" />
    <preference for="Temando\Shipping\Model\Order\OrderItemInterface"
                type="Temando\Shipping\Model\Order\OrderItem" />
    <preference for="Temando\Shipping\Model\Order\OrderRecipientInterface"
                type="Temando\Shipping\Model\Order\OrderRecipient" />

    <preference for="Temando\Shipping\Model\Checkout\Attribute\CheckoutFieldInterface"
                type="Temando\Shipping\Model\Checkout\Attribute\CheckoutField" />
    <preference for="Temando\Shipping\Api\Data\Checkout\AddressInterface"
                type="Temando\Shipping\Model\Checkout\Address" />
    <preference for="Temando\Shipping\Api\Data\Order\OrderReferenceInterface"
                type="Temando\Shipping\Model\Order\OrderReference" />
    <preference for="Temando\Shipping\Api\Data\Order\ShippingExperienceInterface"
                type="Temando\Shipping\Model\Order\ShippingExperience" />
    <preference for="Temando\Shipping\Api\Data\Shipment\ShipmentReferenceInterface"
                type="Temando\Shipping\Model\Shipment\ShipmentReference" />

    <preference for="Temando\Shipping\Model\ResourceModel\Repository\AddressRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\Checkout\AddressRepository" />
    <preference for="Temando\Shipping\Model\ResourceModel\Repository\CarrierRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\Carrier\CarrierRepository" />
    <preference for="Temando\Shipping\Model\ResourceModel\Repository\LocationRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\Location\LocationRepository" />
    <preference for="Temando\Shipping\Model\ResourceModel\Repository\PackagingRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\Packaging\PackagingRepository" />
    <preference for="Temando\Shipping\Model\ResourceModel\Repository\DispatchRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\Dispatch\DispatchRepository" />
    <preference for="Temando\Shipping\Model\ResourceModel\Repository\OrderRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\Order\OrderRepository" />
    <preference for="Temando\Shipping\Model\ResourceModel\Repository\ShipmentRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\Shipment\ShipmentRepository" />
    <preference for="Temando\Shipping\Model\StreamEventInterface"
                type="Temando\Shipping\Model\StreamEvent" />
    <preference for="Temando\Shipping\Model\ResourceModel\EventStream\EventRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\EventStream\EventRepository" />
    <preference for="Temando\Shipping\Rest\Adapter\EventStreamApiInterface"
                type="Temando\Shipping\Rest\Adapter"/>
    <preference for="Temando\Shipping\Model\ResourceModel\Repository\RmaShipmentRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\Rma\RmaShipmentRepository" />

    <preference for="Temando\Shipping\Rest\Request\StreamCreateRequestInterface"
                type="Temando\Shipping\Rest\Request\StreamCreateRequest"/>
    <preference for="Temando\Shipping\Model\ResourceModel\EventStream\StreamRepositoryInterface"
                type="Temando\Shipping\Model\ResourceModel\EventStream\StreamRepository"/>

    <!-- internal -->
    <preference for="Temando\Shipping\Model\Config\ModuleConfigInterface"
                type="Temando\Shipping\Model\Config\ModuleConfig"/>
    <preference for="Temando\Shipping\Model\Shipment\ShipmentProviderInterface"
                type="Temando\Shipping\Model\Shipment\ShipmentProvider" />
    <preference for="Temando\Shipping\Webservice\Config\WsConfigInterface"
                type="Temando\Shipping\Model\Config\ModuleConfig"/>
    <preference for="Temando\Shipping\Rest\AuthenticationInterface"
                type="Temando\Shipping\Rest\Authentication"/>

    <preference for="Temando\Shipping\Rest\Adapter\AuthenticationApiInterface"
                type="Temando\Shipping\Rest\AuthAdapter"/>
    <preference for="Temando\Shipping\Rest\Adapter\CarrierApiInterface"
                type="Temando\Shipping\Rest\Adapter"/>
    <preference for="Temando\Shipping\Rest\Adapter\CompletionApiInterface"
                type="Temando\Shipping\Rest\Adapter"/>
    <preference for="Temando\Shipping\Rest\Adapter\ContainerApiInterface"
                type="Temando\Shipping\Rest\Adapter"/>
    <preference for="Temando\Shipping\Rest\Adapter\LocationApiInterface"
                type="Temando\Shipping\Rest\Adapter"/>
    <preference for="Temando\Shipping\Rest\Adapter\OrderApiInterface"
                type="Temando\Shipping\Rest\Adapter"/>
    <preference for="Temando\Shipping\Rest\Adapter\ShipmentApiInterface"
                type="Temando\Shipping\Rest\Adapter"/>

    <preference for="Temando\Shipping\Rest\RestClientInterface"
                type="Temando\Shipping\Rest\RestClient"/>
    <preference for="Temando\Shipping\Webservice\Logger\LogAnonymizerInterface"
                type="Temando\Shipping\Rest\Logger\Anonymizer"/>
    <preference for="Temando\Shipping\Rest\SchemaMapper\Reflection\ReflectionInterface"
                type="Temando\Shipping\Rest\SchemaMapper\Reflection"/>
    <preference for="Temando\Shipping\Rest\SchemaMapper\Reflection\PropertyHandlerInterface"
                type="Temando\Shipping\Rest\SchemaMapper\Reflection\PropertyHandler"/>
    <preference for="Temando\Shipping\Rest\SchemaMapper\Reflection\TypeHandlerInterface"
                type="Temando\Shipping\Rest\SchemaMapper\TypeHandler"/>
    <preference for="Temando\Shipping\Rest\SchemaMapper\ParserInterface"
                type="Temando\Shipping\Rest\SchemaMapper\Json"/>
    <preference for="Temando\Shipping\Rest\Request\AuthRequestInterface"
                type="Temando\Shipping\Rest\Request\AuthRequest"/>
    <preference for="Temando\Shipping\Rest\Request\ItemRequestInterface"
                type="Temando\Shipping\Rest\Request\ItemRequest"/>
    <preference for="Temando\Shipping\Rest\Request\ListRequestInterface"
                type="Temando\Shipping\Rest\Request\ListRequest"/>
    <preference for="Temando\Shipping\Rest\Request\OrderRequestInterface"
                type="Temando\Shipping\Rest\Request\OrderRequest"/>
    <preference for="Temando\Shipping\Rest\Request\StreamEventItemRequestInterface"
                type="Temando\Shipping\Rest\Request\StreamEventItemRequest"/>
    <preference for="Temando\Shipping\Rest\Request\StreamEventListRequestInterface"
                type="Temando\Shipping\Rest\Request\StreamEventListRequest"/>
    <preference for="Temando\Shipping\Rest\Request\Type\OrderRequestTypeInterface"
                type="Temando\Shipping\Rest\Request\Type\OrderRequestType"/>
    <preference for="Temando\Shipping\Webservice\HttpClientInterface"
                type="Temando\Shipping\Webservice\HttpClient" />

    <!-- third party library adapter -->
    <virtualType name="Temando\Shipping\Http\VirtualClient" type="Zend\Http\Client" shared="false" />

    <!-- argument di overrides -->
    <type name="Temando\Shipping\Rest\Adapter">
        <arguments>
            <argument name="logger" xsi:type="object">Temando\Shipping\Webservice\Logger</argument>
        </arguments>
    </type>
    <type name="Temando\Shipping\Rest\AuthAdapter">
        <arguments>
            <argument name="logger" xsi:type="object">Temando\Shipping\Webservice\Logger</argument>
        </arguments>
    </type>
    <type name="Temando\Shipping\Model\Shipping\Carrier">
        <arguments>
            <argument name="logger" xsi:type="object">Temando\Shipping\Webservice\Logger</argument>
        </arguments>
    </type>
    <type name="Temando\Shipping\Rest\Logger\Anonymizer">
        <arguments>
            <argument name="secrets" xsi:type="array">
                <item name="accountId" xsi:type="string">[hidden]</item>
                <item name="bearerToken" xsi:type="string">[hidden]</item>
                <item name="sessionToken" xsi:type="string">[hidden]</item>
                <item name="organisationName" xsi:type="string">[hidden]</item>
                <item name="personFirstName" xsi:type="string">[hidden]</item>
                <item name="personLastName" xsi:type="string">[hidden]</item>
                <item name="phoneNumber" xsi:type="string">[hidden]</item>
                <item name="email" xsi:type="string">[hidden]</item>
                <item name="lines" xsi:type="string">[hidden]</item>
            </argument>
        </arguments>
    </type>
    <type name="Temando\Shipping\Webservice\HttpClient">
        <arguments>
            <argument name="client" xsi:type="object">Temando\Shipping\Http\VirtualClient</argument>
        </arguments>
    </type>
    <type name="Temando\Shipping\Webservice\Logger">
        <arguments>
            <argument name="name" xsi:type="string">temando</argument>
            <argument name="handlers" xsi:type="array">
                <item name="debug" xsi:type="object">Temando\Shipping\Webservice\Logger\Handler\FileSystemHandler</item>
                <item name="error" xsi:type="object">Temando\Shipping\Webservice\Logger\Handler\FileSystemHandler</item>
                <item name="critical" xsi:type="object">Temando\Shipping\Webservice\Logger\Handler\FileSystemHandler</item>
            </argument>
        </arguments>
    </type>
    <type name="Temando\Shipping\Model\Config\ConfigAccessor">
        <arguments>
            <argument name="systemConfigType" xsi:type="object">\Magento\Config\App\Config\Type\System</argument>
        </arguments>
    </type>

    <!-- interceptor plugins -->
    <type name="Magento\Sales\Model\Order\ShipmentDocumentFactory">
        <plugin name="temando-shipping-shiftShipmentCreationArguments"
                type="Temando\Shipping\Plugin\Sales\Order\ShipmentDocumentFactoryPlugin" />
    </type>

    <type name="Magento\Sales\Model\Order\ShipmentRepository">
        <plugin name="temando-shipping-loadAndSaveExtensionAttributes"
                type="Temando\Shipping\Plugin\Sales\Order\ShipmentRepositoryPlugin" />
    </type>
    <type name="Magento\Sales\Model\Order\ShippingBuilder">
        <plugin name="temando-shipping-extendShippingAssignments"
                type="Temando\Shipping\Plugin\Sales\Order\ShippingBuilderPlugin" />
    </type>
    <type name="Magento\Quote\Model\Quote\Address\ToOrderAddress">
        <plugin name="temando-shipping-convertQuoteAddress"
                type="Temando\Shipping\Plugin\Quote\Address\ToOrderAddressPlugin" />
    </type>

    <type name="Magento\Multishipping\Block\Checkout\Addresses">
        <plugin name="temando-shipping-appendCheckoutFields"
                type="Temando\Shipping\Plugin\Multishipping\Checkout\GetAddressesHtmlSelectPlugin" />
    </type>
    <type name="Magento\Multishipping\Model\Checkout\Type\Multishipping">
        <plugin name="temando-shipping-shiftCheckoutFieldSelection"
                type="Temando\Shipping\Plugin\Multishipping\Checkout\MultishippingSavePlugin" />
    </type>

    <type name="Magento\Framework\View\Asset\Minification">
        <plugin name="preventComponentryMinification" type="Temando\Shipping\Plugin\View\MinificationPlugin" />
    </type>

    <!-- collection arguments -->
    <type name="Magento\Framework\View\Element\UiComponent\DataProvider\CollectionFactory">
        <arguments>
            <argument name="collections" xsi:type="array">
                <item name="temando_packaging_listing_data_source" xsi:type="string">Temando\Shipping\Model\ResourceModel\Packaging\Grid\Collection</item>
                <item name="temando_location_listing_data_source" xsi:type="string">Temando\Shipping\Model\ResourceModel\Location\Grid\Collection</item>
                <item name="temando_carrier_listing_data_source" xsi:type="string">Temando\Shipping\Model\ResourceModel\Carrier\Grid\Collection</item>
                <item name="temando_dispatch_listing_data_source" xsi:type="string">Temando\Shipping\Model\ResourceModel\Dispatch\Grid\Collection</item>
                <item name="temando_rma_shipment_listing_data_source" xsi:type="string">Temando\Shipping\Model\ResourceModel\Rma\RmaShipment\Grid\Collection</item>
            </argument>
        </arguments>
    </type>
    <type name="Magento\Framework\Model\Entity\RepositoryFactory">
        <arguments>
            <argument name="entities" xsi:type="array">
                <item name="Temando\Shipping\Api\Data\Order\OrderReferenceInterface" xsi:type="string">Temando\Shipping\Model\ResourceModel\Repository\OrderReferenceRepositoryInterface</item>
                <item name="Temando\Shipping\Api\Data\Shipment\ShipmentReferenceInterface" xsi:type="string">Temando\Shipping\Model\ResourceModel\Repository\ShipmentRepositoryInterface</item>
            </argument>
        </arguments>
    </type>

    <type name="Magento\Framework\EntityManager\MetadataPool">
        <arguments>
            <argument name="metadata" xsi:type="array">
                <item name="Temando\Shipping\Api\Data\Checkout\AddressInterface" xsi:type="array">
                    <item name="entityTableName" xsi:type="string">temando_checkout_address</item>
                    <item name="identifierField" xsi:type="string">entity_id</item>
                </item>
                <item name="Temando\Shipping\Api\Data\Order\OrderReferenceInterface" xsi:type="array">
                    <item name="entityTableName" xsi:type="string">temando_order</item>
                    <item name="identifierField" xsi:type="string">entity_id</item>
                </item>
                <item name="Temando\Shipping\Api\Data\Shipment\ShipmentReferenceInterface" xsi:type="array">
                    <item name="entityTableName" xsi:type="string">temando_shipment</item>
                    <item name="identifierField" xsi:type="string">entity_id</item>
                </item>
            </argument>
        </arguments>
    </type>

    <type name="Magento\Framework\EntityManager\HydratorPool">
        <arguments>
            <argument name="hydrators" xsi:type="array">
                <item name="Temando\Shipping\Api\Data\Checkout\AddressInterface" xsi:type="string">Magento\Framework\EntityManager\AbstractModelHydrator</item>
                <item name="Temando\Shipping\Api\Data\Order\OrderReferenceInterface" xsi:type="string">Magento\Framework\EntityManager\AbstractModelHydrator</item>
                <item name="Temando\Shipping\Api\Data\Shipment\ShipmentReferenceInterface" xsi:type="string">Magento\Framework\EntityManager\AbstractModelHydrator</item>
            </argument>
        </arguments>
    </type>
</config>
